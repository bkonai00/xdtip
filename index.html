<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Me</title>
    <style>
        body { font-family: sans-serif; background: #222; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: #333; padding: 30px; border-radius: 10px; width: 320px; text-align: center; }
        input, textarea, button { width: 90%; margin: 10px 0; padding: 10px; border-radius: 5px; border: none; }
        button { background: #00ff00; color: black; font-weight: bold; cursor: pointer; }
        button:hover { background: #00cc00; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Donate to Rahul</h2>
        <input id="name" placeholder="Your Name" />
        <input id="email" placeholder="Your Email" />
        <input id="amount" type="number" placeholder="Amount (â‚¹)" />
        <textarea id="msg" placeholder="Message"></textarea>
        <button onclick="pay()">Send Donation</button>
    </div>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        // --- EDIT THESE TWO LINES ---
        const BACKEND_URL = "https://YOUR-RENDER-URL.onrender.com"; 
        const RAZORPAY_KEY_ID = "YOUR_RAZORPAY_KEY_ID_HERE";
        // -----------------------------

        async function pay() {
            const amt = document.getElementById('amount').value;
            const name = document.getElementById('name').value;
            const msg = document.getElementById('msg').value;

            // 1. Ask Backend to create order
            const res = await fetch(`${BACKEND_URL}/create-order`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ amount: amt })
            });
            const order = await res.json();

            // 2. Open Payment
            const options = {
                "key": RAZORPAY_KEY_ID,
                "amount": order.amount,
                "currency": "INR",
                "name": "Stream Donation",
                "order_id": order.id,
                "handler": async function (response){
                    // 3. Payment Success -> Tell Backend to Alert OBS
                    await fetch(`${BACKEND_URL}/verify-payment`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_signature: response.razorpay_signature,
                            name: name,
                            amount: amt,
                            message: msg
                        })
                    });
                    alert("Thanks for the donation!");
                }
            };
            new Razorpay(options).open();
        }
    </script>
</body>
</html>
